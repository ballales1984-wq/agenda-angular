<div class="chat-container">
  <div class="chat-header">
    <div class="chat-header-content">
      <h3>ğŸ’¬ Chat Intelligente</h3>
      <p>Scrivi in linguaggio naturale, penso a tutto io!</p>
    </div>
    <button 
      class="voice-toggle"
      (click)="speechService.toggle()"
      [class.active]="speechService.isEnabled()"
      [title]="speechService.isEnabled() ? 'Disattiva voce' : 'Attiva voce'"
    >
      {{ speechService.isEnabled() ? 'ğŸ”Š' : 'ğŸ”‡' }}
    </button>
  </div>

  <div class="chat-messages">
    <div 
      *ngFor="let msg of messages()" 
      class="message"
      [class.user-message]="msg.sender === 'user'"
      [class.assistant-message]="msg.sender === 'assistant'"
      [class.success]="msg.type === 'success'"
      [class.error]="msg.type === 'error'"
      [class.info]="msg.type === 'info'"
    >
      <div class="message-content">
        <div class="message-avatar">
          {{ msg.sender === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–' }}
        </div>
        <div class="message-bubble">
          <p>{{ msg.text }}</p>
          <div class="message-footer">
            <span class="message-time">
              {{ msg.timestamp | date:'HH:mm' }}
            </span>
            <button 
              *ngIf="msg.sender === 'assistant'"
              (click)="speechService.speak(msg.text)"
              class="speak-btn"
              title="Leggi ad alta voce"
            >
              ğŸ”Š
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="isLoading()" class="message assistant-message">
      <div class="message-content">
        <div class="message-avatar">ğŸ¤–</div>
        <div class="message-bubble loading">
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="suggestions">
    <p class="suggestions-label">ğŸ’¡ Prova questi esempi:</p>
    <div class="suggestions-grid">
      <button 
        *ngFor="let suggestion of suggestions"
        (click)="useSuggestion(suggestion)"
        class="suggestion-btn"
      >
        {{ suggestion }}
      </button>
    </div>
  </div>

  <div class="chat-input">
    <button
      *ngIf="speechService.isRecognitionSupported()"
      (click)="startVoiceInput()"
      [disabled]="isLoading() || speechService.isListening()"
      class="mic-btn"
      [class.listening]="speechService.isListening()"
      title="Parla invece di scrivere"
    >
      <span *ngIf="!speechService.isListening()">ğŸ¤</span>
      <span *ngIf="speechService.isListening()" class="mic-pulse">ğŸ¤</span>
    </button>
    
    <textarea
      [(ngModel)]="userInput"
      (keypress)="onKeyPress($event)"
      placeholder="Scrivi o parla... (es: 'Domani riunione alle 10')"
      rows="2"
      [disabled]="isLoading()"
    ></textarea>
    
    <button 
      (click)="sendMessage()"
      [disabled]="!userInput() || isLoading()"
      class="send-btn"
    >
      <span *ngIf="!isLoading()">ğŸ“¤ Invia</span>
      <span *ngIf="isLoading()">â³</span>
    </button>
  </div>
</div>
