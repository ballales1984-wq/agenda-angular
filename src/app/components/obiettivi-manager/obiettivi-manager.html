<div class="obiettivi-container">
  <div class="obiettivi-header">
    <h3>{{ langService.t('goals.title') }}</h3>
    <p>Traccia i tuoi obiettivi e monitora il progresso</p>
    <button (click)="apriForm()" class="btn-nuovo">
      {{ langService.t('goals.create') }}
    </button>
  </div>

  <!-- Form nuovo obiettivo -->
  <div *ngIf="isCreating()" class="form-obiettivo">
    <div class="form-header">
      <h4>{{ langService.t('goals.create') }}</h4>
      <button (click)="chiudiForm()" class="btn-close">âœ•</button>
    </div>

    <input
      [(ngModel)]="nuovoObiettivo().titolo"
      [placeholder]="langService.t('goals.name')"
      class="form-input"
    />

    <textarea
      [(ngModel)]="nuovoObiettivo().descrizione"
      [placeholder]="langService.t('goals.description')"
      rows="3"
      class="form-textarea"
    ></textarea>

    <div class="form-row">
      <select [(ngModel)]="nuovoObiettivo().categoria" class="form-select">
        <option value="studio">ðŸ“š {{ langService.t('category.study') }}</option>
        <option value="lavoro">ðŸ’¼ {{ langService.t('category.work') }}</option>
        <option value="salute">ðŸ’ª {{ langService.t('category.health') }}</option>
        <option value="personale">ðŸŽ¯ {{ langService.t('category.personal') }}</option>
      </select>

      <select [(ngModel)]="nuovoObiettivo().frequenza" class="form-select">
        <option value="giornaliero">ðŸ“… {{ langService.t('frequency.daily') }}</option>
        <option value="settimanale">ðŸ“† {{ langService.t('frequency.weekly') }}</option>
        <option value="mensile">ðŸ“Š {{ langService.t('frequency.monthly') }}</option>
      </select>
    </div>

    <div class="form-group">
      <label>{{ langService.t('goals.hoursNeeded') }}: {{ nuovoObiettivo().ore_necessarie }}h</label>
      <input
        type="range"
        [(ngModel)]="nuovoObiettivo().ore_necessarie"
        min="1"
        max="100"
        class="form-range"
      />
    </div>

    <button (click)="creaObiettivo()" class="btn-crea">
      {{ langService.t('goals.save') }}
    </button>
  </div>

  <!-- Lista obiettivi -->
  <div class="obiettivi-grid">
    <div *ngIf="apiService.obiettivi().length === 0" class="empty-state">
      <p class="empty-icon">ðŸŽ¯</p>
      <p>{{ langService.t('goals.noGoals') }}</p>
    </div>

    <div
      *ngFor="let obiettivo of apiService.obiettivi()"
      class="obiettivo-card"
      [style.border-left-color]="getColoreCategoria(obiettivo.categoria)"
    >
      <!-- Header -->
      <div class="obiettivo-header">
        <span class="obiettivo-icon">{{ getIconaCategoria(obiettivo.categoria) }}</span>
        <div class="obiettivo-info">
          <h4>{{ obiettivo.titolo }}</h4>
          <p *ngIf="obiettivo.descrizione">{{ obiettivo.descrizione }}</p>
        </div>
        <button (click)="eliminaObiettivo(obiettivo.id!)" class="btn-delete">{{ langService.t('goals.delete') }}</button>
      </div>

      <!-- Progress -->
      <div class="progresso-container">
        <div class="progresso-info">
          <span>{{ obiettivo.ore_completate }}h / {{ obiettivo.ore_necessarie }}h</span>
          <span class="progresso-percent">{{ obiettivo.progresso }}%</span>
        </div>
        <div class="progress-bar">
          <div
            class="progress-fill"
            [style.width.%]="obiettivo.progresso"
            [style.background-color]="getColoreCategoria(obiettivo.categoria)"
          ></div>
        </div>
      </div>

      <!-- Actions -->
      <div class="obiettivo-actions">
        <button (click)="aggiornaProgresso(obiettivo.id!, 1)" class="btn-add-time">
          +1h
        </button>
        <button (click)="aggiornaProgresso(obiettivo.id!, 2)" class="btn-add-time">
          +2h
        </button>
        <button (click)="aggiornaProgresso(obiettivo.id!, 5)" class="btn-add-time">
          +5h
        </button>
      </div>

      <!-- Badge completato -->
      <div *ngIf="obiettivo.completato" class="badge-completato">
        {{ langService.t('goals.complete') }}
      </div>
    </div>
  </div>
</div>
